UiBoard.dart
---
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/material.dart'; // 플러터의 머티리얼 디자인 위젯을 사용하기 위한 임포트입니다.
import 'package:ontheway_notebook/login/login_screen.dart'; // 로그인 화면을 위한 임포트입니다.
import 'package:cloud_firestore/cloud_firestore.dart'; // Firestore 데이터베이스를 사용하기 위한 임포트입니다.
import 'WriteBoard.dart';
import 'PostManager.dart';

// BoardPage 클래스는 게시판 화면의 상태를 관리하는 StatefulWidget 입니다.
class BoardPage extends StatefulWidget {
  @override
  _BoardPageState createState() => _BoardPageState(); // 상태(State) 객체를 생성합니다.
}

// _BoardPageState 클래스는 BoardPage의 상태를 관리합니다.
class _BoardPageState extends State<BoardPage> {
  // Firestore 인스턴스를 생성하여 데이터베이스에 접근할 수 있게 합니다.
  final FirebaseFirestore firestore = FirebaseFirestore.instance;
  // PostManager 인스턴스 생성
  final postManager = PostManager();

  // Firestore의 'posts' 컬렉션으로부터 게시글 목록을 스트림 형태로 불러오는 함수입니다.
  Stream<List<DocumentSnapshot>> getPosts() {
    return firestore.collection('posts').snapshots().map((snapshot) {
      return snapshot.docs.toList(); // 스냅샷의 문서들을 리스트로 변환하여 반환합니다.
    });
  }


  // build 함수는 위젯을 렌더링하는 데 사용됩니다.
  @override
  Widget build(BuildContext context) {
    return Scaffold(

      appBar: AppBar(
        backgroundColor: Colors.orange, // 앱 바의 배경색을 오렌지색으로 설정합니다.
        title: Text('게시판'), // 앱 바의 타이틀을 '게시판'으로 설정합니다.
        centerTitle: true,

        leading: IconButton(
          icon: Icon(Icons.arrow_back), // 뒤로 가기 아이콘을 설정합니다.
          onPressed: () {
            // 아이콘 버튼이 눌렸을 때 수행할 동작을 정의합니다.
            Navigator.pushReplacement(
                context, MaterialPageRoute(builder: (context) => LoginScreen())); // 로그인 화면으로 이동합니다.
          },
        ),

        actions: [
          IconButton(
            icon: Icon(Icons.create), // '생성' 아이콘을 설정합니다.
            onPressed: () {
              // 아이콘 버튼이 눌렸을 때 새 게시글 작성 화면으로 이동합니다.
              Navigator.push(
                context,
                MaterialPageRoute(builder: (context) => NewPostScreen()), // NewPostScreen 위젯으로 이동합니다.
              );
            },
          ),
          IconButton(
            icon: Icon(Icons.person),
            onPressed: (){
              // 본인 확인 클래스 생성시 그 클래스로 이동하는 코드 추가
            },
          )
        ],
      ),

//게시판 몸통
      body: Column(
        children: <Widget>[
          SizedBox(height: 10), // AppBar와 Row 사이에 20픽셀의 높이를 가진 공간을 추가합니다.
          Row(
            mainAxisAlignment: MainAxisAlignment.spaceAround,
            children: <Widget>[
              IconButton(
                icon: Icon(Icons.home),
                onPressed: (){
                  ScaffoldMessenger.of(context).showSnackBar(
                      SnackBar(
                        content: Text("상대방이 있는 위치 입니다.", textAlign: TextAlign.center,),
                        // behavior: SnackBarBehavior.floating,
                        duration: Duration(seconds: 1),
                      ),
                  );
                },
              ),

              IconButton(
                icon: Icon(Icons.store),
                onPressed: (){
                  ScaffoldMessenger.of(context).showSnackBar(
                    SnackBar(
                      content: Text("가게 위치 입니다.", textAlign: TextAlign.center,),
                      // behavior: SnackBarBehavior.floating,
                      duration: Duration(seconds: 1),
                      ),
                    );
                },
              ),

              IconButton(
                icon: Icon(Icons.monetization_on),
                onPressed: (){
                  ScaffoldMessenger.of(context).showSnackBar(
                    SnackBar(
                      content: Text("헬퍼 비용입니다.", textAlign: TextAlign.center,),
                      // behavior: SnackBarBehavior.floating,
                      duration: Duration(seconds: 1),
                    ),
                  );
                },
              ),
            ],
          ),

          Flexible(
              child: StreamBuilder<List<DocumentSnapshot>>(
                stream: getPosts(), // getPosts 함수로부터 게시글 목록 스트림을 가져옵니다.
                builder: (context, snapshot) {
                  // 스트림의 상태에 따라 다른 위젯을 반환합니다.
                  if (snapshot.connectionState == ConnectionState.waiting) {
                    // 데이터를 기다리는 중이라면 로딩 인디케이터를 보여줍니다.
                    return Center(child: CircularProgressIndicator());
                  } else if (snapshot.hasError) {
                    // 스트림에서 오류가 발생하면 오류 메시지를 보여줍니다.
                    return Center(child: Text('오류가 발생했습니다.'));
                  } else if (snapshot.hasData) {
                    // 스트림에 데이터가 있으면, 데이터를 리스트뷰로 보여줍니다.
                    final posts = snapshot.data!;

                    return ListView(
                      children: posts.map((doc) {
                        // 문서들을 순회하면서 각각의 문서를 카드 형태로 보여줍니다.
                        Map<String, dynamic> data = doc.data() as Map<String, dynamic>; // 문서의 데이터를 맵으로 변환합니다.
                        return GestureDetector(
                        onTap: (){
                          postManager.showPostDetailsOrEditDeleteDialog(context, doc);
                        },
                        child: Card(
                          child: Container(
                            height: 100,
                          child: Padding(
                            padding: const EdgeInsets.all(8.0),
                            child: Row(
                              children: <Widget>[
                                Expanded(
                                  // 왼쪽 컬럼에 Padding 추가
                                  child: Padding(
                                    padding: EdgeInsets.only(right: 8.0), // 오른쪽에만 패딩을 추가합니다.
                                    child: Text(
                                      data['my_location'] ?? '제목 없음',
                                      textAlign: TextAlign.center,
                                      style: TextStyle(fontSize: 20.0, fontWeight: FontWeight.bold),
                                    ),
                                  ),
                                ),
                                Expanded(
                                  // 가운데 컬럼은 그대로 둡니다.
                                  child: Text(
                                    data['store'] ?? '내용 없음',
                                    textAlign: TextAlign.center,
                                    style: TextStyle(fontSize: 20.0)
                                  ),
                                ),
                                Expanded(
                                  // 오른쪽 컬럼에 Padding 추가
                                  child: Padding(
                                    padding: EdgeInsets.only(left: 8.0), // 왼쪽에만 패딩을 추가합니다.
                                    child: Text(
                                      data['cost'] ?? '추가 내용 없음',
                                      textAlign: TextAlign.center,
                                      style: TextStyle(fontSize: 20.0, fontWeight: FontWeight.bold),
                                    ),
                                  ),
                                ),
                              ],
                            ),
                          ),
                          ),
                        )
                        );
                      }).toList(), // map 함수로 생성된 Iterable을 List로 변환합니다.
                    );
                  }
                  else {
                    // 스트림에 데이터가 없으면 '게시글이 없습니다' 메시지를 보여줍니다.
                    return Center(child: Text('게시글이 없습니다.'));
                  }
                },
             ),
           ),
        ],
      ),
    );
  }
}





PostManager.dart
---
import 'package:flutter/material.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'WriteBoard.dart';

class PostManager {
  // 필요한 상태나 컨트롤러를 정의합니다.
  void _showEditDeleteDialog(BuildContext context, DocumentSnapshot doc) {
    showDialog(
      context: context,
      builder: (context) {
        return AlertDialog(
          title: Text('선택하세요'),
          content: Text('이 게시물을 삭제하거나 수정하시겠습니까?'),
          actions: <Widget>[
            TextButton(
              child: Text('삭제'),
              onPressed: () {
                _deletePost(doc.id);
                Navigator.of(context).pop();
              },
            ),
            TextButton(
              child: Text('수정'),
              onPressed: () {
                _navigateToEditPostScreen(context, doc);
                Navigator.of(context).pop();
              },
            ),
          ],
        );
      },
    );
  }

  void _deletePost(String docId) async {
    try {
      await FirebaseFirestore.instance.collection('posts').doc(docId).delete();
      // 성공적으로 삭제 후 UI 업데이트 로직 (옵션)
    } catch (e) {
      // 오류 처리
    }
  }

  void _navigateToEditPostScreen(BuildContext context, DocumentSnapshot doc) {
    Navigator.of(context).push(
      MaterialPageRoute(
        builder: (context) => NewPostScreen(post: doc),
      ),
    );
  }

  void showPostDetailsOrEditDeleteDialog(BuildContext context, DocumentSnapshot doc) {
    String? userEmail = getUserEmail();
    bool isMyPost = userEmail == doc['user_email'];

    if (isMyPost) {
      // 내 게시물인 경우: 수정 및 삭제 옵션
      _showEditDeleteDialog(context, doc);
    } else {
      // 다른 사람의 게시물인 경우: 요청사항 보기
      showDialog(
        context: context,
        builder: (context) {
          return AlertDialog(
            title: Text('주문 시킬 내역 및 요청사항'),
            content: Text(doc['Request'] ?? '요청사항 없음'),
            actions: <Widget>[
              TextButton(
                child: Text('닫기'),
                onPressed: () {
                  Navigator.of(context).pop();
                },
              ),
            ],
          );
        },
      );
    }
  }

  String? getUserEmail() {
    final user = FirebaseAuth.instance.currentUser;
    return user?.email;
  }
// 기타 필요한 메서드들...
}




WriteBoard.dart
---
import 'package:flutter/material.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:firebase_auth/firebase_auth.dart';


// 새 게시글을 작성하는 화면을 위한 StatefulWidget입니다.
class NewPostScreen extends StatefulWidget {
  final DocumentSnapshot? post;

  NewPostScreen({this.post});

  @override
  _NewPostScreenState createState() => _NewPostScreenState();
}

// NewPostScreen의 상태를 관리하는 클래스입니다.
class _NewPostScreenState extends State<NewPostScreen> {
  // 사용자 입력을 관리하기 위한 컨트롤러들입니다.
  final TextEditingController _locationController = TextEditingController(); //사용자 위치 필드를 위한 컨트롤러입니다.
  final TextEditingController _storeController = TextEditingController(); // 주문 시킬 가게를 위한 컨트롤러입니다.
  final TextEditingController _costController = TextEditingController(); // 비용을 위한 컨트롤러 입니다.
  final TextEditingController _RequestController = TextEditingController(); // 요청사항을 위한 컨트롤러 입니다.

// 사용자의 이메일을 가져오는 함수입니다.
  String? getUserEmail() {
    final user = FirebaseAuth.instance.currentUser;
    return user != null ? user.email : '이메일 없음';
  }

  // 게시물을 업로드하는 함수입니다.
  Future<void> _uploadPost() async {
    try {
      // Firestore의 'posts' 컬렉션에 새 문서를 추가합니다.

      // 현재 로그인된 사용자의 이메일을 가져옵니다.
      String? email = getUserEmail();

      // 문서 이름을 'my_location' 필드와 'user_email' 필드로 설정
      String documentName = "${_locationController.text}_${email ?? 'unknown'}";

      await FirebaseFirestore.instance.collection('posts').doc(documentName).set({
        'my_location': _locationController.text, // 제목 필드
        'store': _storeController.text, // 내용 필드
        'cost': _costController.text, // 새로운 필드 추가
        'user_email': email, // 사용자 이메일 필드 추가
        'Request' : _RequestController.text,
        'date': DateTime.now(), // 현재 날짜와 시간
      });
      // 성공적으로 업로드 후 이전 화면으로 돌아갑니다.
      Navigator.of(context).pop();
    } catch (e) {
      // 오류 발생 시 사용자에게 알립니다.
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('게시물 업로드에 실패했습니다.')), // 스낵바로 오류 메시지를 보여줍니다.
      );
    }
  }

  // 위젯을 빌드하는 메소드입니다.
  @override
  Widget build(BuildContext context) {

    return Scaffold(
      appBar: AppBar(
        title: Text('게시물 작성'), // 앱 바의 타이틀을 '새 게시물 작성'으로 설정합니다.
        backgroundColor: Colors.orange,
      ),

      body: Padding(
        padding: EdgeInsets.all(16.0), // 전체 패딩을 설정합니다.
        child: Column(

          // 세로로 위젯들을 나열하기 위한 컬럼 위젯입니다.
          children: <Widget>[

            TextField(
              controller: _locationController, // 제목을 입력받기 위한 텍스트 필드입니다.
              decoration: InputDecoration(
                labelText: '본인 위치', // 라벨을 '제목'으로 설정합니다.
                contentPadding: EdgeInsets.symmetric(vertical: 20.0),
              ),
              textInputAction: TextInputAction.next, // 다음 필드로 이동할 수 있도록 설정
            ),

            SizedBox(height: 8.0), // 위젯 사이의 간격을 주기 위한 SizedBox입니다.

            TextField(
              controller: _storeController, // 내용을 입력받기 위한 텍스트 필드입니다.
              decoration: InputDecoration(
                labelText: '주문 시킬 가게', // 라벨을 '내용'으로 설정합니다.\
                contentPadding: EdgeInsets.symmetric(vertical: 20.0),
              ),
              textInputAction: TextInputAction.next, // 다음 필드로 이동할 수 있도록 설정
            ),

            SizedBox(height: 16.0), // 위젯 사이의 간격을 주기 위한 SizedBox입니다.

            TextField(

              controller: _costController, // 내용을 입력받기 위한 텍스트 필드입니다.
              decoration: InputDecoration(
                labelText: '비용', // 라벨을 '내용'으로 설정합니다.
                contentPadding: EdgeInsets.symmetric(vertical: 20.0),
              ),
              textInputAction: TextInputAction.next, // 다음 필드로 이동할 수 있도록 설정
            ),

            SizedBox(height: 16.0,),

            TextField(
              controller: _RequestController, // 내용을 입력받기 위한 텍스트 필드입니다.
              decoration: InputDecoration(
                labelText: '요청사항', // 라벨을 '내용'으로 설정합니다.
                contentPadding: EdgeInsets.symmetric(vertical: 100.0),
              ),
              textInputAction: TextInputAction.next, // 다음 필드로 이동할 수 있도록 설정
            ),

            SizedBox(height: 16.0,),


            ElevatedButton(
              style: ElevatedButton.styleFrom(
                backgroundColor: Colors.orange,

              ),
              child: Text('게시하기'), // 버튼의 텍스트를 '게시하기'로 설정합니다.
              onPressed: _uploadPost, // 버튼이 눌렸을 때 _uploadPost 함수를 실행합니다.
            ),
          ],
        ),
      ),
    );
  }

  @override
  void initState() {
    super.initState();
    if (widget.post != null) {
      // widget.post에서 데이터를 사용하여 필드를 초기화
    }
  }
}
